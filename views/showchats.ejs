<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../stylesheets/showchats.css" />
  </head>
  <body>
    <div id="main">
      <div class="left_section">
        <h4 id="userId" style="display: none"><%= user._id %></h4>
        <h4 id="userName" style="display: none"><%= user.username %></h4>
        <% include ../views/partials/chatfooter.ejs %>

        <div id="side_menu">
          <h1 id="remove">X</h1>
        </div>

        <!-- search bar form -->
        <form id="serach_bar_form" action="">
          <input
            type="text"
            id="search_bar"
            value="Search or start a new chat"
          />
          <img class="search_icon" src="../images/searchnormal1.png" alt="" />
        </form>
        <h4>online Users <span id="onlineusers"></span></h4>

        <div class="chats_with">
          <% frnds.forEach(frnd => {%>

          <div class="chats">
            <img
              style="pointer-events: none"
              class="frnd_img"
              src="../images/google.png"
              alt=""
            />
            <div style="pointer-events: none" class="from_content">
              <h3 style="pointer-events: none"><%= frnd.username %></h3>
              <h6 style="pointer-events: none"><%= frnd.mongoId %></h6>
              <h6 style="pointer-events: none">hey! , How are you?</h6>
            </div>
            <div style="pointer-events: none" class="chat_time">
              <h6 style="pointer-events: none">12.22pm</h6>
              <h3 style="pointer-events: none">.</h3>
            </div>
          </div>
          <%}); %>
        </div>
      </div>

      <div style="opacity: 0" id="right_section" class="left_section">
        <div class="right_chat_footer">
          <img class="frnd_dp" src="" alt="" />
          <div class="frnd_name">
            <h4 id="frnd_name"></h4>
            <h6 id="frnd_id"></h6>
            <lead>online</lead>
          </div>
          <img class="chat_search" src="../images/searchnormal1.png" alt="" />
        </div>

        <div class="all_chats_content">
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
          <div class="msg"></div>
        </div>

        <!-- send msg form -->
        <form id="send_msg_form" action="" method="post">
          <input
            id="type_msg"
            type="text"
            placeholder="Type a new message..."
          />
          <input type="files" style="display: none" />
          <input type="submit" value="submit" style="display: none" />
          <img class="upload_opt" src="../images/arrowcircleup2.png" alt="" />
          <img class="send_msg" src="../images/send.png" alt="" />
        </form>
      </div>
    </div>
  </body>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.2/socket.io.js"
    integrity="sha512-VJ6+sp2E5rFQk05caiXXzQd1wBABpjEj1r5kMiLmGAAgwPItw1YpqsCCBtq8Yr1x6C49/mTpRdXtq8O2RcZhlQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <script src="../javascripts/showchats.js"></script>
  <script>
    var socket = io();
    var userName = "";
    var userId = "";
    var username = document.getElementById("userName").innerHTML;
    var userid = document.getElementById("userId").innerHTML;
    // console.log(username);
    userName = username;
    userId = userid;
    // console.log(userName + "../loggedInUser");
    // console.log(userId + "../loggedInUser");

    socket.emit("connected_userId", { userId, userName });

    //listening online users
    var onlineusers = document.querySelector("#onlineusers");
    socket.on("online_users", (data) => {
      onlineusers.innerHTML = data.socketId.length;
      console.log(data);
    });

    //private msg setup id and all
    var whole_frnds_section = document.querySelector(".chats_with");
    const right_section = document.querySelector("#right_section");
    const frnd_name = document.querySelector("#frnd_name");
    const frnd_id = document.querySelector("#frnd_id");
    frnd_id;
    whole_frnds_section.addEventListener("click", (e) => {
      console.log(e);
      var frndId = e.target.children[1].children[1].innerHTML;
      console.log(frndId);
      right_section.style.opacity = "1";
      frnd_name.innerHTML = e.target.children[1].children[0].innerHTML;
      frnd_id.innerHTML = frndId;
    });

    //sending message to frnd

    const send_msg_form = document.querySelector("#send_msg_form");
    send_msg_form.addEventListener("submit", (e) => {
      e.preventDefault();
      var frndMongo_id = document.querySelector("#frnd_id").innerHTML;
      const type_msg = document.querySelector("#type_msg").value;
      console.log(type_msg);
      //sending msg to this friend
      socket.emit("private_msg", { type_msg, frndMongo_id });
      console.log(frndMongo_id + "../..144");
      console.log("not sub");
    });
  </script>
</html>
